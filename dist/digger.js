!function(){"use strict";var t={905:function(t,e){var n=function(t){if("object"==typeof t&&null!==t){if("function"==typeof Object.getPrototypeOf){var e=Object.getPrototypeOf(t);return e===Object.prototype||null===e}return"[object Object]"===Object.prototype.toString.call(t)}return!1},o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce((function(t,e){return Object.keys(e).forEach((function(i){Array.isArray(t[i])&&Array.isArray(e[i])?t[i]=Array.from(new Set(t[i].concat(e[i]))):n(t[i])&&n(e[i])?t[i]=o(t[i],e[i]):t[i]=e[i]})),t}),{})};e.Z=o},122:function(t,e,n){n.d(e,{K:function(){return I}});var o,i,r=n(905),a=function(){function t(t,e,n,o){var i=this;this.votes=new Map,this.ended=!1,this.instance=t,this.callback=o;var r=this.instance.playerIdToAuth.get(n.id);this.votes.set(r,"y"),this.voteCommandHandler=this.instance.registerCommand(["!y","!n"],"",this.handleVote),this.instance.on("playerLeave",this.reCount),this.instance.on("playerJoin",this.reCount),this.timeout=window.setTimeout((function(){i.instance.notify("Vote: "+e+" failed"),i.end()}),this.instance.config.voteTime),this.instance.notify("Vote: "+e+" started, vote with !y or !n, current "),this.reCount()}return t.prototype.handleVote=function(t,e){var n=this.instance.playerIdToAuth.get(t.id);this.votes.get(n)?this.instance.error("You have already voted in this election, you may be interested in !stopthecount",t.id):(this.votes.set(n,e[1]),this.reCount())},t.prototype.reCount=function(){var t=Object.keys(this.instance.playerIdToAuth).length,e=2==t?2:t/2,n=Array.from(this.votes.values()).reduce((function(t,e){return t[e]+=1,t}),{y:0,n:0}),o="Vote: "+name+", "+n.y+"/"+t+" in favour, "+n.n+"/"+t+" against. ";n.y>=e?(this.instance.notify(o+"Moving ahead with "+name),this.end(),this.callback()):n.n>=e||n.n+n.y==t?(this.instance.notify(o+"Dismissed "+name),this.end()):this.instance.notify(o+", participate using !y or !n")},t.prototype.end=function(){this.ended||(this.ended=!0,this.instance.currentElection=void 0,this.voteCommandHandler(),this.instance.off("playerLeave",this.reCount),this.instance.off("playerJoin",this.reCount),clearTimeout(this.timeout))},t}(),s=function(){function t(t,e){this.listeners=[],this.commandHandlers=[],t.log(this.constructor.name+" loaded"),this.instance=t,this.config=e,e.enabled&&(this.enable(),t.log(this.constructor.name+" enabled with "+JSON.stringify(e)))}return t.prototype.disable=function(){var t=this;this.instance.log(this.constructor.name+" disabled"),this.listeners.forEach((function(e){var n=e.name,o=e.listener;t.instance.off(n,o)})),this.commandHandlers.forEach((function(t){return t()}))},t.prototype.on=function(t,e){this.listeners.push({name:t,listener:e}),this.instance.on(t,e)},t.prototype.registerCommand=function(t,e,n){var o=this.instance.registerCommand(t,e,n);return this.commandHandlers.push(o),o},t}(),c=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.auths=new Set(n.auths),o}return c(e,t),e.prototype.enable=function(){var t=this;this.on("playerJoin",this.handleJoin),this.registerCommand(["!a"],"Admin: !a s[kip] | r[estart] | d[efcon6] | m[ute] t | u[nmute] t | k[ick] t | b[an] t | c[ban] t",(function(e,n){if(e.admin){var o=n.replace(/ +/," ").split(" ");if(2==o.length)switch(o[1][0]){case"s":t.instance.room.endGame();case"r":t.instance.room.restartGame();case"d":t.instance.error("Not yet implemented",e.id);default:return t.respondWithUsage(e.id)}else if(o.length>=3){var i=t.instance.findPlayer(o[2]);if(!i)return void t.instance.notify("Could not find targetPlayer: "+o[2]+", use !list",e.id);switch(o[2][0]){case"m":t.mute(e,i);case"u":t.unMute(e,i);case"k":t.instance.room.kickPlayer(i.id,"You have been kicked "+o[3],!1);case"b":t.instance.temporaryBan(i,"You have been kicked for "+Math.round(t.config.kickDuration/1e3/60)+" minutes "+o[3],t.config.kickDuration);case"c":t.instance.room.clearBan(i.id);default:return t.respondWithUsage(e.id)}}else t.respondWithUsage(e.id)}else t.instance.error("Not admin",e.id)}))},e.prototype.mute=function(t,e){var n=this.config.muteDuration/1e3/60;this.instance.notify(e.name+" has been muted for "+n+' minutes, use "!a unmute '+this.instance.shortId(e.id)+'" to unmute'),this.instance.mute(e.id,this.config.muteDuration)},e.prototype.unMute=function(t,e){this.instance.notify(e.name+" has been ungagged"),this.instance.unMute(e.id)},e.prototype.respondWithUsage=function(t){this.instance.notify("Usage:",t),this.instance.notify("!a s or !a skip",t),this.instance.notify("!a r or !a restart",t),this.instance.notify("!a d or !a defcon6",t),this.instance.notify("!a m 123 or !a mute 123",t),this.instance.notify("!a u 123 or !a unmute 123",t),this.instance.notify("!a k 123 or !a kick 123",t),this.instance.notify("!a b 123 or !a ban 123",t),this.instance.notify("!a c 123 or !a cban 123",t)},e.prototype.handleJoin=function(t){var e=t.detail;this.auths.has(e.auth)&&this.instance.room.setPlayerAdmin(e.id,!0)},e}(s),l=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),p=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.playingPlayers=new Map,o.hotPlayers=new Map,o.kickCandidates=new Map,o.timeout=n.timeout,o.graceTime=n.graceTime,o.hotTimeout=n.hotTimeout,o.warnTimeout=o.timeout-o.graceTime,o}return l(e,t),e.prototype.enable=function(){this.on("playerJoin",this.handleMotd),this.config.kickAFKSpectatorWhenFull&&this.on("playerJoin",this.purgeInactiveSpectators),this.on("playerTeamChange",this.handleTeamChange),this.on("playerActivity",this.activate),this.on("playerLeave",this.handleLeave)},e.prototype.handleMotd=function(t){var e=t.detail,n="AFK detection loaded, players are moved to spectators after "+this.timeout/1e3+" seconds of inactivity";this.instance.notify(n,e.id)},e.prototype.handleTeamChange=function(t){var e=t.detail,n=e.player;e.byPlayer,n.team==I.spectatorTeam?this.clearPlayerTimeout(n.id):(this.kickCandidates.delete(n.id),this.resetPlayerTimeout(n.id))},e.prototype.handleLeave=function(t){var e=t.detail;this.kickCandidates.delete(e.id),this.clearPlayerTimeout(e.id)},e.prototype.activate=function(t){var e=this,n=t.detail;this.hotPlayers.get(n.id)||(this.hotPlayers.set(n.id,window.setTimeout((function(){return e.hotPlayers.delete(n.id)}),this.hotTimeout)),this.playingPlayers.get(n.id)&&this.resetPlayerTimeout(n.id))},e.prototype.resetPlayerTimeout=function(t){var e=this;this.clearPlayerTimeout(t),this.playingPlayers.set(t,window.setTimeout((function(){return e.evictPlayer(t)}),this.warnTimeout))},e.prototype.clearPlayerTimeout=function(t){var e=this.playingPlayers.get(t);e&&clearTimeout(e),this.playingPlayers.delete(t)},e.prototype.evictPlayer=function(t){var e=this,n="You will be moved to spectators due too inactivity in "+this.graceTime/1e3+" seconds, please move";this.instance.notify(n,t);var o=this.playingPlayers.get(t);setTimeout((function(){var n=e.instance.room.getPlayer(t);if(n&&n.team!=I.spectatorTeam&&e.playingPlayers.get(t)==o){e.instance.softNotify("Moving "+n.name+" to spectators due to inactivity");var i="You were afk for more than "+e.timeout/1e3+" seconds, moving you to spectators";e.instance.error(i,t),e.instance.room.setPlayerTeam(t,0),e.kickCandidates.set(t,new Date)}}),this.graceTime)},e.prototype.purgeInactiveSpectators=function(t){if(t.detail,this.instance.room.getPlayerList().length>=this.instance.initOptions.maxPlayers){var e=Array.from(this.kickCandidates).reduce((function(t,e){return t[1]<e[1]?t:e}));if(e){var n=this.instance.room.getPlayer(e[0]);this.instance.softNotify("Server full, kicking oldest afk spectator "+n.name),this.instance.room.kickPlayer(e[0],"Server full, kicking oldest afk spectator",!1)}}},e}(s),h=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aliases=new Map,e}return h(e,t),e.prototype.enable=function(){var t=this;this.on("playerJoin",this.handleJoin),this.registerCommand(["!a","!aliases"],"Check the previously known aliases of a player",(function(e,n){var o=n.split(" ");if(o.length<2)t.instance.error("Usage: !a 123 or !a playerName",e.id);else{var i=o[o.length-1],r=t.instance.findPlayer(i);if(!r)return t.instance.error("Could not find player",e.id),void t.instance.error("Usage: !a 123 or !aliases playerName",e.id);var a=t.instance.playerIdToAuth.get(r.id);t.instance.notify(r.name+" previously known names:",e.id),t.namesByLastUsed(a).forEach((function(n){var o=n[0],i=n[1];if(o!=r.name){var a=new Date;t.instance.notify(o+" "+(+a-+i)/1e3/60/60+" hours ago",e.id)}}))}})),this.config.announceNameChange&&this.on("changePlayerName",this.handleChangeName)},e.prototype.handleChangeName=function(t){var e=this,n=t.detail,o=this.namesByLastUsed(n.auth).slice(0,this.config.annouceNamesCount);this.instance.room.getPlayerList().forEach((function(t){e.instance.playerIdToAuth.get(t.id)!=n.auth&&(e.instance.notify(n.name+" changed their name, last "+o.length+" previously known names:",t.id),o.forEach((function(n){var o=n[0];return n[1],e.instance.notify(o,t.id)})))}))},e.prototype.namesByLastUsed=function(t){var e=this.aliases.get(t);return Array.from(e).sort((function(t,e){return e[1].getTime()-t[1].getTime()}))},e.prototype.handleJoin=function(t){var e=t.detail,n=this.aliases.get(e.auth);n?(n.get(e.name)&&this.instance.emit("changePlayerName",e),n.set(e.name,new Date)):(this.aliases.set(e.auth,new Map),this.instance.emit("newPlayer",e))},e}(s),y=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.connectionMap=new Map,e.playerIdToConn=new Map,e}return y(e,t),e.prototype.enable=function(){this.on("playerJoin",this.addPlayer),this.on("playerLeave",this.removePlayer)},e.prototype.addPlayer=function(t){var e=t.detail;this.playerIdToConn.set(e.id,e.conn);var n=this.connectionMap.get(e.conn);if(n){if(n.size>=this.config.maxConnectionsPerIP){var o=Array.from(n).reduce((function(t,e){return t[1]<e[1]?t:e}));this.instance.room.kickPlayer(o[0],"Too many connections",!1),n.delete(o[0])}n.set(e.id,new Date)}else this.connectionMap.set(e.conn,new Map([[e.id,new Date]]))},e.prototype.removePlayer=function(t){var e=t.detail,n=this.playerIdToConn.get(e.id);this.connectionMap.get(n).delete(e.id),this.playerIdToConn.delete(e.id)},e}(s),m=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e.prototype.enable=function(){var t=this;this.registerCommand(["!l","!list"],"List the players showing an id and name",(function(e,n){t.instance.notify("Players: id, name",e.id),t.instance.room.getPlayerList().forEach((function(n){t.instance.notify(t.instance.shortId(n.id)+"\t"+n.name,e.id)}))}))},e}(s),v=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.playingPlayers=new Map,e.idToAuth=new Map,e}return v(e,t),e.prototype.enable=function(){this.on("playerJoin",this.addPlayer),this.on("playerLeave",this.removePlayer)},e.prototype.removePlayer=function(t){var e=t.detail;this.idToAuth.delete(e.id);var n=this.idToAuth.get(e.id);n&&this.playingPlayers.delete(n)},e.prototype.addPlayer=function(t){var e=t.detail;this.idToAuth.set(e.id,e.auth);var n=this.playingPlayers.get(e.auth);n&&this.instance.room.kickPlayer(n.id,"Only one connection allowed",!1),this.playingPlayers.set(e.auth,e)},e}(s),b=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return b(e,t),e.prototype.enable=function(){this.on("gameEnd",this.handleGameEnd)},e.prototype.handleGameEnd=function(){var t=this,e=this.instance.room.getPlayerList(),n=new Map,o=Array();if(e.forEach((function(e){n.set(e.team,!0);var i=t.instance.room.getPlayerScore(e.id);i&&o.push({player:e,score:i})})),this.instance.emit("playerScores",o),"tdm"==this.instance.room.getSettings().gameMode){var i=Array();Object.keys(n).map((function(e){var n=parseInt(e,10);if(n>0){var o=t.instance.room.getTeamScore(n);i.push({team:n,score:o})}})),this.instance.emit("teamScores",i)}},e}(s),k=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return k(e,t),e.prototype.enable=function(){var t=this;this.config.url&&(this.webSocket=new WebSocket(this.config.url)),this.config.events.forEach((function(e){t.on(e,t.publish)})),this.on("gameStart",this.handleGameStart)},e.prototype.handleGameStart=function(t){this.publish(new CustomEvent("GameSettings",{detail:this.instance.room.getSettings()}))},e.prototype.publish=function(t){var e={time:Date.now(),event:t.type};void 0!==t.detail&&(e.detail=t.detail),this.webSocket&&this.webSocket.readyState==WebSocket.OPEN&&this.webSocket.send(JSON.stringify(e)),this.instance.log(e)},e}(s),T=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),O=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.enable=function(){var t=this,e=this.config.muteDuration/1e3/60;this.registerCommand(["!vm","!votemute"],"Mute player vote, type !vm for Usage",(function(n,o){var i=o.split(" ");if(i.length<2)t.instance.error("Usage: !vm 123 or !vm playerName",n.id);else{var r=i[i.length-1],a=t.instance.findPlayer(r);if(!a)return t.instance.error("Could not find player",n.id),void t.instance.error("Usage: !vm 123 or !vm playerName",n.id);t.instance.election("Mute "+a.name,n,(function(){t.instance.mute(a.id,t.config.muteDuration),t.instance.notify(a.name+" has been muted for "+e+" minutes")}))}}))},e}(s),C=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return C(e,t),e.prototype.enable=function(){var t=this,e=Math.round(this.config.kickDuration/1e3/60);this.registerCommand(["!vk","!votekick"],"Kick player vote, type !vk for Usage",(function(n,o){var i=o.split(" ");if(i.length<2)t.instance.error("Usage: !vk 123 or !vk playerName",n.id);else{var r=i[i.length-1],a=t.instance.findPlayer(r);if(!a)return t.instance.error("Could not find player",n.id),void t.instance.error("Usage: !vk 123 or !vk playerName",n.id);t.instance.election("Kick "+a.name+" for "+e+" minutes",n,(function(){t.instance.temporaryBan(a,"Vote kick",t.config.kickDuration)}))}}))},e}(s),S=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return S(e,t),e.prototype.enable=function(){var t=this;this.registerCommand(["!vr","!voterestart"],"Restart map vote",(function(e,n){t.instance.election("Skip map",e,(function(){t.instance.room.restartGame(),t.instance.notify("Game restarted")}))}))},e}(s),j=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return j(e,t),e.prototype.enable=function(){var t=this;this.registerCommand(["!vs","!voteskip"],"Skip map vote",(function(e,n){t.instance.election("Skip map",e,(function(){return t.instance.room.endGame()}))}))},e}(s);!function(t){t[t.captcha=0]="captcha",t[t.changePlayerName=1]="changePlayerName",t[t.gameEnd=2]="gameEnd",t[t.gameEnd2=3]="gameEnd2",t[t.gameStart=4]="gameStart",t[t.gameTick=5]="gameTick",t[t.newPlayer=6]="newPlayer",t[t.playerActive=7]="playerActive",t[t.playerActivity=8]="playerActivity",t[t.playerAdminChange=9]="playerAdminChange",t[t.playerChat=10]="playerChat",t[t.playerInactive=11]="playerInactive",t[t.playerJoin=12]="playerJoin",t[t.playerKicked=13]="playerKicked",t[t.playerKilled=14]="playerKilled",t[t.playerLeave=15]="playerLeave",t[t.playerScores=16]="playerScores",t[t.playerTeamChange=17]="playerTeamChange",t[t.roomLink=18]="roomLink",t[t.teamScores=19]="teamScores"}(i||(i={}));var I=function(){function t(e,n,o,i){var a,s=this;if(this.commands=new Map,this.commandDescriptions=new Map,this.playerIdToAuth=new Map,this.mutedPlayers=new Map,this.activePlayers=new Map,this.electionTimeouts=new Map,this.window=e,this.config=i,this.initialSettings=o,this.config=(0,r.Z)(t.defaultConfig,i),e.onWLLoaded)throw"already loaded";if(!((a=n).roomName&&a.maxPlayers&&void 0!==a.public&&a.token))throw"roomName, maxPlayers, public and token must be set";if(this.config.configVersion!=t.configVersion)throw"Your config is out of date and not compatible with latest digger, check https://gitlab.com/webliero/digger";this.initOptions=n,this.validateInitOptions(),this.fullRoom=e.WLInit(n),this.room=this.fullRoom,this.room.setSettings(o),this.serverId=this.initOptions.roomName.replace(/[^A-Z0-9]/gi,"-").toLowerCase(),this.instanceId=Date.now().toString(36)+"#"+Math.round(Math.random()*Math.pow(36,3)).toString(36),this.setNewGame(),this.eventTarget=new EventTarget,this.registerRoomCallbacks(),this.on("gameStart",(function(t){s.setNewGame()})),this.on("playerJoin",(function(t){var e=t.detail;return s.playerIdToAuth.set(e.id,e.auth)})),this.on("playerLeave",(function(t){var e=t.detail;return s.playerIdToAuth.delete(e.id)})),this.on("playerChat",this.handlePlayerChat),this.on("playerTeamChange",this.handleActive),this.on("roomLink",(function(t){return t.detail,s.log("Started: `${url}`")})),this.on("captcha",(function(){return s.log("Failed to start: Faulty token")})),this.on("playerJoin",(function(e){var n=e.detail;return s.notify(t.motd,n.id)})),this.registerCommand(["!h","!help"],"Display this help",this.handleHelp),this.registerCommand(["!stc","!stopthecount"],"Request to stop the count of a vote",this.handleStopTheCount),this.enablePlugins()}return t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];console.log.apply(console,t.map((function(t){return JSON.stringify(t)})))},t.prototype.on=function(t,e){this.eventTarget.addEventListener(t,e)},t.prototype.once=function(t,e){this.eventTarget.addEventListener(t,e,{once:!0})},t.prototype.off=function(t,e){this.eventTarget.removeEventListener(t,e)},t.prototype.emit=function(t,e){return this.eventTarget.dispatchEvent(new CustomEvent(t,{detail:e,cancelable:!0}))},t.prototype.notify=function(t,e){this.room.sendAnnouncement(t,e,16776960,"bold",2)},t.prototype.softNotify=function(t,e){this.room.sendAnnouncement(t,e,14540253)},t.prototype.error=function(t,e){this.room.sendAnnouncement(t,e,16711680,"bold",2)},t.prototype.registerCommand=function(t,e,n){var o=this;return this.commandDescriptions.set(t[0],function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,i++)o[i]=r[a];return o}(t.map((function(t){return t.padEnd(4," ")})),[e]).join(" ")),t.forEach((function(t){if("!"!=t[0]||t.length<2)throw t+" command not valid";if(o.commands.get(t))throw"command already registered";o.commands.set(t,n)})),function(){o.commandDescriptions.delete(t[0]),t.forEach((function(t){return o.commands.delete(t)}))}},t.prototype.findPlayer=function(t){var e=this,n=this.room.getPlayerList();return n.find((function(n){return e.shortId(n.id).toString()==t}))||n.find((function(e){return e.name==t}))},t.prototype.mute=function(t,e){var n=this,o=Math.round(e/1e3/60);this.error("You have been muted for "+o+" minutes",t);var i=this.playerIdToAuth.get(t);this.mutedPlayers.set(i,{time:new Date(Date.now()+e),timeout:window.setTimeout((function(){return n.unMute(t)}),e)})},t.prototype.temporaryBan=function(t,e,n){var o=this,i=Math.round(n/1e3/60);this.room.kickPlayer(t.id,e,!0),this.notify(t.name+" has been kicked for "+i+" minutes"),setTimeout((function(){return o.room.clearBan(t.id)}),n)},t.prototype.unMute=function(t){this.error("You have been unmuted",t);var e=this.playerIdToAuth.get(t);this.mutedPlayers.delete(e)},t.prototype.clearMutes=function(){this.mutedPlayers.clear()},t.prototype.shortId=function(t){return t%1e3},t.prototype.election=function(t,e,n){var o=this,i=this.playerIdToAuth.get(e.id);this.electionTimeouts.get(i)?this.error("You may only start a vote once every "+this.config.voteTimeout/1e3+" seconds",e.id):this.currentElection?this.notify("Another vote is already active, wait your turn",e.id):(this.electionTimeouts.set(i,window.setTimeout((function(){return o.electionTimeouts.delete(i)}),this.config.voteTimeout)),this.currentElection=new a(this,t,e,(function(){o.currentElection=void 0,n()})))},t.prototype.enablePlugins=function(){var t=this;Object.entries(this.config.plugins).forEach((function(e){var n=e[0];if(e[1].enabled)switch(n){case"admin":new u(t,t.config.plugins.admin);case"afk":new p(t,t.config.plugins.afk);case"aliases":new f(t,t.config.plugins.aliases);case"connection":new d(t,t.config.plugins.connection);case"list":new g(t,t.config.plugins.list);case"onePlayer":new P(t,t.config.plugins.onePlayer);case"scores":new w(t,t.config.plugins.scores);case"slurper":new _(t,t.config.plugins.slurper);case"voteMutePlayer":new O(t,t.config.plugins.voteMutePlayer);case"voteKickPlayer":new A(t,t.config.plugins.voteKickPlayer);case"voteRestartMap":new M(t,t.config.plugins.voteRestartMap);case"voteSkipMap":new E(t,t.config.plugins.voteSkipMap)}}))},t.prototype.handleHelp=function(t,e){var n=this;this.notify("Available commands:",t.id),Array.from(this.commandDescriptions.values()).sort().filter((function(e){return t.admin||!("!a"==e.substr(0,2))})).forEach((function(e){return n.notify(e,t.id)}))},t.prototype.handleActive=function(t){var e=t.detail,n=e.player;e.byPlayer,0==n.team?(this.emit("playerInactive",n),this.activePlayers.delete(n.id)):this.activePlayers.get(n.id)||(this.emit("playerActive",n),this.activePlayers.set(n.id,!0))},t.prototype.handlePlayerChat=function(t){var e=t.detail,n=e.player,o=e.message;if("!"==(o=o.trim())[0]){var i=o.indexOf(" "),r=-1==i?o:o.substr(0,i),a=this.commands.get(r);if(a)a(n,o);else{var s='"'+r+'" not recognized command';this.room.sendAnnouncement(s,n.id,16711680,"bold",2)}t.preventDefault()}var c=this.playerIdToAuth.get(n.id),u=this.mutedPlayers.get(c);if(u){var l=Math.round((u.time.getTime()-Date.now())/1e3/60);this.room.sendAnnouncement("You are muted for "+l+" minutes more",n.id,16711680,"bold",2),t.preventDefault()}},t.prototype.setNewGame=function(){this.gameStartTime=new Date,this.gameId=Date.now().toString(36)+"#"+Math.round(Math.random()*Math.pow(36,3)).toString(36)},t.prototype.handleStopTheCount=function(t,e){this.currentElection?this.notify(t.name+" has requested to stop the count, we of course ignore it and the counting of votes will continue"):this.notify(t.name+" has requested to stop the count, the vote is over and we ignore it")},t.prototype.registerRoomCallbacks=function(){var t=this;this.fullRoom.onPlayerJoin=function(e){t.emit("playerJoin",e)},this.fullRoom.onPlayerLeave=function(e){t.emit("playerLeave",e)},this.fullRoom.onPlayerKicked=function(e,n,o,i){t.emit("playerKicked",{player:e,reason:n,ban:o,byPlayer:i})},this.fullRoom.onPlayerChat=function(e,n){return t.emit("playerChat",{player:e,message:n})},this.fullRoom.onPlayerTeamChange=function(e,n){t.emit("playerTeamChange",{player:e,byPlayer:n})},this.fullRoom.onPlayerAdminChange=function(e,n){t.emit("playerAdminChange",{player:e,byPlayer:n})},this.fullRoom.onGameTick=function(){t.emit("gameTick",null)},this.fullRoom.onPlayerActivity=function(e){t.emit("playerActivity",e)},this.fullRoom.onRoomLink=function(e){t.emit("roomLink",e)},this.fullRoom.onGameStart=function(){t.emit("gameStart",null)},this.fullRoom.onGameEnd=function(){t.emit("gameEnd",null)},this.fullRoom.onGameEnd2=function(){t.emit("gameEnd2",null)},this.fullRoom.onPlayerKilled=function(e,n){t.emit("playerKilled",{killed:e,killer:n})},this.fullRoom.onCaptcha=function(){t.emit("captcha",null)}},t.prototype.validateInitOptions=function(){if(!this.initOptions.roomName)throw"you must set a roomName";if(!this.initOptions.maxPlayers)throw"you must set maxPlayers"},t.prototype.generateId=function(){return Date.now().toString(36)+"#"+Math.round(Math.random()*Math.pow(36,3)).toString(36)},t.configVersion="0.1.0",t.spectatorTeam=0,t.motd="Digger "+t.configVersion+" loaded, write !h or !help in chat for commands",t.defaultConfig={configVersion:t.configVersion,voteTime:3e4,voteTimeout:45e3,plugins:{admin:{enabled:!0,auths:[],muteDuration:9e5,kickDuration:9e5},afk:{enabled:!0,timeout:6e4,graceTime:1e4,hotTimeout:3e3,kickAFKSpectatorWhenFull:!0},aliases:{enabled:!0,announceNameChange:!0,annouceNamesCount:4},connection:{enabled:!0,maxConnectionsPerIP:3},list:{enabled:!0},onePlayer:{enabled:!0},scores:{enabled:!0},slurper:{enabled:!0,events:["captcha","changePlayerName","gameEnd","gameEnd2","gameStart","newPlayer","playerActive","playerAdminChange","playerChat","playerInactive","playerJoin","playerKicked","playerKilled","playerLeave","playerScores","playerTeamChange","roomLink","teamScores"]},voteMutePlayer:{enabled:!0,muteDuration:9e5},voteKickPlayer:{enabled:!0,kickDuration:9e5},voteRestartMap:{enabled:!0},voteSkipMap:{enabled:!0}}},t}()}},e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n(122)}();